{"version":3,"file":"753dd0ff.js","sources":["../../../node_modules/@shopify/hydrogen/dist/esnext/utilities/isClient/isClient.js","../../../node_modules/@shopify/hydrogen/dist/esnext/utilities/isServer/isServer.js","../../../node_modules/@shopify/hydrogen/dist/esnext/foundation/Analytics/ClientAnalytics.js"],"sourcesContent":["/** The `isClient` utility is a function that returns a boolean indicating\n * if the code was run on the client.\n */\nexport function isClient() {\n    return typeof window !== 'undefined';\n}\n","import { isClient } from '../isClient';\n/** The `isServer` utility is a function that returns a `boolean` indicating\n * if the code was run on the server.\n */\nexport function isServer() {\n    return !isClient();\n}\n","import { getNamedspacedEventname } from './utils';\nimport { isServer } from '../../utilities';\nimport { eventNames } from './const';\nimport { EVENT_PATHNAME } from '../../constants';\nconst subscribers = {};\nlet pageAnalyticsData = {};\nconst guardDupEvents = {};\nconst USAGE_ERROR = 'ClientAnalytics should only be used within the useEffect callback or event handlers';\nfunction isInvokedFromServer() {\n    if (isServer()) {\n        console.warn(USAGE_ERROR);\n        return true;\n    }\n    return false;\n}\nfunction pushToPageAnalyticsData(data, namespace) {\n    if (isInvokedFromServer())\n        return;\n    if (namespace) {\n        pageAnalyticsData[namespace] = Object.assign({}, pageAnalyticsData[namespace] || {}, data);\n    }\n    else {\n        pageAnalyticsData = Object.assign({}, pageAnalyticsData, data);\n    }\n}\nfunction getPageAnalyticsData() {\n    if (isInvokedFromServer())\n        return;\n    return pageAnalyticsData;\n}\nfunction resetPageAnalyticsData() {\n    if (isInvokedFromServer())\n        return;\n    pageAnalyticsData = {};\n}\nfunction publish(eventname, guardDup = false, payload) {\n    if (isInvokedFromServer())\n        return;\n    const namedspacedEventname = getNamedspacedEventname(eventname);\n    const subs = subscribers[namedspacedEventname];\n    const combinedPayload = Object.assign({}, pageAnalyticsData, payload);\n    // De-dup events due to re-renders\n    if (guardDup) {\n        const eventGuardTimeout = guardDupEvents[namedspacedEventname];\n        if (eventGuardTimeout) {\n            clearTimeout(eventGuardTimeout);\n        }\n        const namespacedTimeout = setTimeout(() => {\n            publishEvent(subs, combinedPayload);\n        }, 100);\n        guardDupEvents[namedspacedEventname] = namespacedTimeout;\n    }\n    else {\n        publishEvent(subs, combinedPayload);\n    }\n}\nfunction publishEvent(subs, payload) {\n    if (subs) {\n        Object.keys(subs).forEach((key) => {\n            subs[key](payload);\n        });\n    }\n}\nfunction subscribe(eventname, callbackFunction) {\n    if (isInvokedFromServer())\n        return { unsubscribe: () => { } };\n    const namedspacedEventname = getNamedspacedEventname(eventname);\n    const subs = subscribers[namedspacedEventname];\n    if (!subs) {\n        subscribers[namedspacedEventname] = {};\n    }\n    const subscriberId = Date.now().toString();\n    subscribers[namedspacedEventname][subscriberId] = callbackFunction;\n    return {\n        unsubscribe: () => {\n            delete subscribers[namedspacedEventname][subscriberId];\n        },\n    };\n}\nfunction pushToServer(init, searchParam) {\n    return fetch(`${EVENT_PATHNAME}${searchParam ? `?${searchParam}` : ''}`, Object.assign({\n        method: 'post',\n        headers: {\n            'cache-control': 'no-cache',\n            'Content-Type': 'application/json',\n        },\n    }, init));\n}\nexport const ClientAnalytics = {\n    pushToPageAnalyticsData,\n    getPageAnalyticsData,\n    resetPageAnalyticsData,\n    publish,\n    subscribe,\n    pushToServer,\n    eventNames,\n};\n"],"names":[],"mappings":"iFAGO,YAAoB,CACvB,MAAO,OAAO,SAAW,WAC7B,CCDO,YAAoB,CACvB,MAAO,CAAC,EAAQ,CACpB,CCFA,KAAM,GAAc,CAAA,EACpB,GAAI,GAAoB,CAAA,EACxB,KAAM,GAAiB,CAAA,EACjB,EAAc,sFACpB,YAA+B,CAC3B,MAAI,GAAQ,EACR,SAAQ,KAAK,CAAW,EACjB,IAEJ,EACX,CACA,WAAiC,EAAM,EAAW,CAC9C,AAAI,EAAqB,GAEzB,CAAI,EACA,EAAkB,GAAa,OAAO,OAAO,CAAA,EAAI,EAAkB,IAAc,GAAI,CAAI,EAGzF,EAAoB,OAAO,OAAO,CAAE,EAAE,EAAmB,CAAI,EAErE,CACA,YAAgC,CAC5B,GAAI,GAAqB,EAEzB,MAAO,EACX,CACA,YAAkC,CAC9B,AAAI,EAAqB,GAEzB,GAAoB,CAAA,EACxB,CACA,WAAiB,EAAW,EAAW,GAAO,EAAS,CACnD,GAAI,EAAqB,EACrB,OACJ,KAAM,GAAuB,EAAwB,CAAS,EACxD,EAAO,EAAY,GACnB,EAAkB,OAAO,OAAO,CAAA,EAAI,EAAmB,CAAO,EAEpE,GAAI,EAAU,CACV,KAAM,GAAoB,EAAe,GACzC,AAAI,GACA,aAAa,CAAiB,EAElC,KAAM,GAAoB,WAAW,IAAM,CACvC,EAAa,EAAM,CAAe,CACrC,EAAE,GAAG,EACN,EAAe,GAAwB,CAC1C,KAEG,GAAa,EAAM,CAAe,CAE1C,CACA,WAAsB,EAAM,EAAS,CACjC,AAAI,GACA,OAAO,KAAK,CAAI,EAAE,QAAQ,AAAC,GAAQ,CAC/B,EAAK,GAAK,CAAO,CAC7B,CAAS,CAET,CACA,WAAmB,EAAW,EAAkB,CAC5C,GAAI,EAAqB,EACrB,MAAO,CAAE,YAAa,IAAM,CAAA,GAChC,KAAM,GAAuB,EAAwB,CAAS,EAE9D,AAAK,AADQ,EAAY,IAErB,GAAY,GAAwB,IAExC,KAAM,GAAe,KAAK,IAAK,EAAC,SAAQ,EACxC,SAAY,GAAsB,GAAgB,EAC3C,CACH,YAAa,IAAM,CACf,MAAO,GAAY,GAAsB,EAC5C,CACT,CACA,CACA,WAAsB,EAAM,EAAa,CACrC,MAAO,OAAM,GAAG,IAAiB,EAAc,IAAI,IAAgB,KAAM,OAAO,OAAO,CACnF,OAAQ,OACR,QAAS,CACL,gBAAiB,WACjB,eAAgB,kBACnB,CACT,EAAO,CAAI,CAAC,CACZ,CACY,KAAC,GAAkB,CAC3B,0BACA,uBACA,yBACA,UACA,YACA,eACA,YACJ"}